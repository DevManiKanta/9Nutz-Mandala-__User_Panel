"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2748],{2748:function(e,a,t){t.r(a),t.d(a,{default:function(){return h}});var s=t(7437),r=t(2265),l=t(7972),d=t(1295),i=t(2741),n=t(5589),o=t(734),c=t(2549),m=t(7216),u=t(9670),p=t(5925),g=t(8207);function h(e){var a;let{initialUser:t=null,initialOrders:h=[]}=e,[x,f]=(0,r.useState)(t||{id:null,name:"Jane Doe",email:"jane@example.com",phone:"",address:"",createdAt:new Date().toISOString()}),[b]=(0,r.useState)(h),[v,y]=(0,r.useState)(!1),[w,j]=(0,r.useState)({name:"",email:"",phone:"",address:"",password:""}),[N,S]=(0,r.useState)(""),[k,A]=(0,r.useState)(!1),[E,C]=(0,r.useState)(!1),[P,q]=(0,r.useState)(!1),D=(0,r.useRef)(null),I=(0,r.useRef)(null),Z=()=>localStorage.getItem("token")||"";(0,r.useEffect)(()=>{_()},[]);let _=async()=>{let e=Z();if(!e){p.toast.error("Not logged in — token missing.");return}C(!0);let a=p.toast.loading("Loading profile...");try{var t,s,r,l,d,i,n;let o=await fetch("".concat(g.I,"/admin/profile"),{method:"GET",headers:{Accept:"application/json",Authorization:"Bearer ".concat(e)}}),c=await o.json().catch(()=>null);if(!o.ok){let e=(null==c?void 0:c.message)||"Failed to fetch profile (".concat(o.status,")");throw p.toast.error(e),Error(e)}if(!c||!c.status||!Array.isArray(c.profile)||0===c.profile.length){let e="Profile not found.";throw p.toast.error(e),Error(e)}let m=c.profile[0],u={id:null!==(t=m.id)&&void 0!==t?t:null,name:null!==(s=m.name)&&void 0!==s?s:"",email:null!==(r=m.email)&&void 0!==r?r:"",phone:m.contact?String(m.contact):null!==(l=m.contact)&&void 0!==l?l:"",address:null!==(d=m.address)&&void 0!==d?d:"",createdAt:null!==(n=null!==(i=m.created_at)&&void 0!==i?i:m.createdAt)&&void 0!==n?n:new Date().toISOString()};f(e=>({...e,...u}));try{let e=localStorage.getItem("user");if(e){let a=JSON.parse(e);localStorage.setItem("user",JSON.stringify({...a,...u}))}}catch(e){}p.toast.dismiss(a)}catch(e){p.toast.dismiss()}finally{C(!1)}};(0,r.useEffect)(()=>{if(v){let e=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}}},[v]),(0,r.useEffect)(()=>{var e;if(v){j({name:x.name||"",email:x.email||"",phone:x.phone||"",address:x.address||"",password:""}),q(!1);let e=setTimeout(()=>{var e,a;let t=null===(e=D.current)||void 0===e?void 0:e.querySelector("input[name='name']");t&&(t.focus(),null===(a=t.select)||void 0===a||a.call(t))},0),a=e=>{"Escape"===e.key&&y(!1)};return document.addEventListener("keydown",a),()=>{clearTimeout(e),document.removeEventListener("keydown",a)}}null===(e=I.current)||void 0===e||e.focus()},[v,x]);let O={name:e=>e&&e.trim()?e.trim().length<2?"Please enter at least 2 characters for name.":"":"Name is required.",email:e=>e&&e.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.trim())?"":"Enter a valid email address.":"Email is required.",phone:e=>{if(!e||!String(e).trim())return"Phone is required.";let a=String(e).replace(/\D/g,"");return a.length<10?"Phone must be at least 10 digits.":a.length>15?"Phone must not exceed 15 digits.":""},address:e=>e&&e.trim()?e.trim().length<5?"Address looks too short.":"":"Address is required.",password:e=>e?e.length<8?"Password must be at least 8 characters.":/[0-9]/.test(e)?"":"Password must contain at least one digit.":""},z=()=>{for(let e of["name","email","phone","address"]){let a=O[e](w[e]);if(a)return a}let e=O.password(w.password);return e||""},F=e=>{let{name:a,value:t}=e.target;j(e=>({...e,[a]:t})),N&&S("")},J=async e=>{var a,t,s,r,l,d,i,n,o,c,m,u,h,b,v,j,N,k,E,C,P,q;null==e||e.preventDefault();let D=z();if(D){S(D),p.toast.error(D);return}let I=Z();if(!I){p.toast.error("Session expired — please login again.");return}A(!0);let _=p.toast.loading("Updating profile...");S("");try{let e=new FormData;e.append("name",w.name.trim()),e.append("email",w.email.trim()),e.append("contact",String(w.phone).trim()),e.append("phone",String(w.phone).trim()),e.append("address",w.address.trim()),w.password&&String(w.password).trim().length>0&&e.append("password",String(w.password));let S=await fetch("".concat(g.I,"/admin/profile/update"),{method:"POST",headers:{Authorization:"Bearer ".concat(I)},body:e}),A=await S.json().catch(()=>null);if(!S.ok){let e=(null==A?void 0:A.message)||(null==A?void 0:A.error)||"Update failed (".concat(S.status,")");throw p.toast.error(e),Error(e)}if(A&&!1===A.status){let e=A.message||"Update failed.";throw p.toast.error(e),Error(e)}let q={...x};if(A){if(Array.isArray(A.profile)&&A.profile.length>0){let e=A.profile[0];q={...q,id:null!==(a=e.id)&&void 0!==a?a:q.id,name:null!==(t=e.name)&&void 0!==t?t:q.name,email:null!==(s=e.email)&&void 0!==s?s:q.email,phone:e.contact?String(e.contact):null!==(r=e.contact)&&void 0!==r?r:q.phone,address:null!==(l=e.address)&&void 0!==l?l:q.address,createdAt:null!==(i=null!==(d=e.created_at)&&void 0!==d?d:e.createdAt)&&void 0!==i?i:q.createdAt}}else if(A.profile&&"object"==typeof A.profile){let e=A.profile;q={...q,id:null!==(n=e.id)&&void 0!==n?n:q.id,name:null!==(o=e.name)&&void 0!==o?o:q.name,email:null!==(c=e.email)&&void 0!==c?c:q.email,phone:e.contact?String(e.contact):null!==(m=e.contact)&&void 0!==m?m:q.phone,address:null!==(u=e.address)&&void 0!==u?u:q.address,createdAt:null!==(b=null!==(h=e.created_at)&&void 0!==h?h:e.createdAt)&&void 0!==b?b:q.createdAt}}else if(A.user&&"object"==typeof A.user){let e=A.user;q={...q,id:null!==(v=e.id)&&void 0!==v?v:q.id,name:null!==(j=e.name)&&void 0!==j?j:q.name,email:null!==(N=e.email)&&void 0!==N?N:q.email,phone:e.contact?String(e.contact):null!==(k=e.contact)&&void 0!==k?k:q.phone,address:null!==(E=e.address)&&void 0!==E?E:q.address,createdAt:null!==(P=null!==(C=e.created_at)&&void 0!==C?C:e.createdAt)&&void 0!==P?P:q.createdAt}}else q={...q,name:w.name.trim(),email:w.email.trim(),phone:String(w.phone).trim(),address:w.address.trim()}}f(q);try{let e=localStorage.getItem("user");if(e){let a=JSON.parse(e);localStorage.setItem("user",JSON.stringify({...a,...q}))}}catch(e){}p.toast.dismiss(_),y(!1)}catch(e){p.toast.dismiss(),(null===(q=p.toast.isActive)||void 0===q?void 0:q.call(p.toast,null==e?void 0:e.message))||p.toast.error((null==e?void 0:e.message)||"Failed to update profile"),S((null==e?void 0:e.message)||"Failed to update profile.")}finally{A(!1)}},U=(null==x?void 0:x.name)||(null==x?void 0:x.fullName)||(null==x?void 0:x.username)||"User";return(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,s.jsxs)("div",{className:"lg:col-span-2 bg-gray-50 border border-gray-200 rounded-xl p-6",children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[(0,s.jsx)(l.Z,{className:"h-5 w-5"})," Personal Details"]}),(0,s.jsxs)("div",{className:"grid sm:grid-cols-2 gap-4",children:[(0,s.jsx)("div",{className:"p-4 bg-white rounded-lg border flex items-start justify-between gap-4",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs uppercase text-gray-500",children:"Name"}),(0,s.jsx)("div",{className:"mt-1 font-medium text-gray-900",children:U})]})}),(0,s.jsxs)("div",{className:"p-4 bg-white rounded-lg border",children:[(0,s.jsx)("div",{className:"text-xs uppercase text-gray-500",children:"Email"}),(0,s.jsxs)("div",{className:"mt-1 font-medium text-gray-900 flex items-center gap-2",children:[(0,s.jsx)(d.Z,{className:"h-4 w-4 text-gray-400"}),null!==(a=null==x?void 0:x.email)&&void 0!==a?a:"—"]})]}),(0,s.jsx)("div",{className:"p-4 bg-white rounded-lg border flex items-start justify-between gap-4",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs uppercase text-gray-500",children:"Phone"}),(0,s.jsxs)("div",{className:"mt-1 font-medium text-gray-900 flex items-center gap-2",children:[(0,s.jsx)(i.Z,{className:"h-4 w-4 text-gray-400"})," ",(null==x?void 0:x.phone)||"—"]})]})})]})]}),(0,s.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-xl p-6",children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[(0,s.jsx)(n.Z,{className:"h-5 w-5"})," Edit Details"]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("div",{className:"flex gap-2",children:(0,s.jsxs)("button",{ref:I,type:"button",onClick:()=>y(!0),className:"inline-flex items-center gap-2 bg-gray-100 hover:bg-gray-200 text-gray-800 font-medium px-4 py-2 rounded-lg transition-colors border",children:[(0,s.jsx)(o.Z,{className:"h-4 w-4"}),"Edit Details"]})}),E&&(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"Loading profile…"})]})]})]}),v&&(0,s.jsxs)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4","aria-hidden":!v,children:[(0,s.jsx)("div",{className:"fixed inset-0 bg-black/40 z-[9998]","aria-hidden":"true",onClick:()=>y(!1)}),(0,s.jsxs)("div",{ref:D,role:"dialog","aria-modal":"true","aria-labelledby":"edit-details-title",className:"relative z-[9999] w-full max-w-lg bg-white rounded-2xl shadow-2xl p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h4",{id:"edit-details-title",className:"text-lg font-semibold",children:"Edit Details"}),(0,s.jsx)("button",{type:"button","aria-label":"Close",onClick:()=>y(!1),className:"rounded-md p-1 hover:bg-gray-100",children:(0,s.jsx)(c.Z,{className:"h-5 w-5 text-gray-600"})})]}),(0,s.jsxs)("form",{onSubmit:J,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),(0,s.jsx)("input",{name:"name",type:"text",value:w.name,onChange:F,placeholder:"Full name",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(N&&O.name(w.name)?"border-red-400":"border-gray-300"),required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,s.jsx)("input",{name:"email",type:"email",value:w.email,onChange:F,placeholder:"Email address",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(N&&O.email(w.email)?"border-red-400":"border-gray-300"),required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),(0,s.jsx)("input",{name:"phone",type:"tel",value:w.phone,onChange:F,placeholder:"Phone number",className:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(N&&O.phone(w.phone)?"border-red-400":"border-gray-300"),required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),(0,s.jsx)("textarea",{name:"address",value:w.address,onChange:F,placeholder:"Enter your address",className:"w-full border rounded-lg px-3 py-2 h-24 resize-y focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(N&&O.address(w.address)?"border-red-400":"border-gray-300"),required:!0})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{name:"password",type:P?"text":"password",value:w.password,onChange:F,placeholder:"Enter new password (leave blank to keep current)",className:"w-full border rounded-lg px-3 py-2 pr-10 focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(N&&O.password(w.password)?"border-red-400":"border-gray-300"),"aria-describedby":N&&O.password(w.password)?"password-error":void 0}),(0,s.jsx)("button",{type:"button",onClick:()=>q(e=>!e),className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 rounded-md hover:bg-gray-100","aria-label":P?"Hide password":"Show password",children:P?(0,s.jsx)(m.Z,{className:"h-5 w-5 text-gray-600"}):(0,s.jsx)(u.Z,{className:"h-5 w-5 text-gray-600"})})]}),N&&O.password(w.password)&&(0,s.jsx)("p",{id:"password-error",className:"text-xs text-red-600 mt-1",children:O.password(w.password)}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Password must be at least 8 characters and include a digit (only required if you enter a new password)."})]}),N&&!O.password(w.password)&&(0,s.jsx)("p",{className:"text-xs text-red-600",role:"alert",children:N}),(0,s.jsxs)("div",{className:"flex items-center justify-end gap-2 pt-2",children:[(0,s.jsx)("button",{type:"button",onClick:()=>y(!1),className:"px-4 py-2 rounded-lg bg-gray-100 hover:bg-gray-200",children:"Cancel"}),(0,s.jsx)("button",{type:"submit",disabled:k,className:"px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white disabled:opacity-60",children:k?"Updating...":"Save Changes"})]})]})]})]})]})}}}]);