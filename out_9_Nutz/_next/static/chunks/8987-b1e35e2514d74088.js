"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8987],{6476:function(e,l,t){t.d(l,{Z:function(){return h}});var a=t(7437),n=t(2265),r=t(2549),s=t(4891),i=t(9883),d=t(734),o=t(5367),c=t(4033),u=t(2502),m=t(5925),p=t(8207);function h(e){var l,t,h,x;let{isOpen:v,onClose:g,items:y,onUpdateQuantity:f,onProceedToPay:b,onClearCart:j,handlePaymentComplete:w}=e;(0,c.useRouter)();let N=null!==(l=(0,u.useAuth)())&&void 0!==l?l:{},C=null!==(t=N.user)&&void 0!==t?t:null,S=null!==(h=N.token)&&void 0!==h?h:null,k=null!=S?S:null!==(x=localStorage.getItem("auth_token"))&&void 0!==x?x:localStorage.getItem("token"),_=null!=C?C:(()=>{try{let e=localStorage.getItem("user");if(!e)return null;return JSON.parse(e)}catch(e){return null}})(),P="".concat(p.I,"/admin/razorpay/order"),A="".concat(p.I,"/admin/razorpay/verify"),E="".concat(p.I,"/user/address"),q=e=>"".concat(p.I,"/user/address/delete/").concat(e),z=e=>"".concat(p.I,"/user/address/update/").concat(e),T="".concat(p.I,"/user/address/add"),[D,O]=(0,n.useState)(!1),I=(0,n.useRef)(!0);(0,n.useEffect)(()=>(I.current=!0,()=>{I.current=!1}),[]);let[M,R]=(0,n.useState)(!1),[F,Z]=(0,n.useState)([]),[L,B]=(0,n.useState)(!1),[J,U]=(0,n.useState)(null),[V,G]=(0,n.useState)(null),[H,K]=(0,n.useState)(!1),[Y,$]=(0,n.useState)(!1),[Q,W]=(0,n.useState)(null),[X,ee]=(0,n.useState)({label:"",line1:"",city:"",state:"",pincode:"",phone:""}),el=e=>{var l,t,a,n,r,s,i;W(null!==(l=null==e?void 0:e.id)&&void 0!==l?l:null),ee({label:null!==(t=null==e?void 0:e.label)&&void 0!==t?t:"",line1:null!==(a=null==e?void 0:e.line1)&&void 0!==a?a:"",city:null!==(n=null==e?void 0:e.city)&&void 0!==n?n:"",state:null!==(r=null==e?void 0:e.state)&&void 0!==r?r:"",pincode:null!==(s=null==e?void 0:e.pincode)&&void 0!==s?s:"",phone:null!==(i=null==e?void 0:e.phone)&&void 0!==i?i:""}),K(!0)},et=()=>{Y||(K(!1),W(null))},ea=e=>{let{name:l,value:t}=e.target;ee(e=>({...e,[l]:t}))},[en,er]=(0,n.useState)(!1),[es,ei]=(0,n.useState)(!1),[ed,eo]=(0,n.useState)({label:"",line1:"",city:"",state:"",pincode:"",phone:""}),ec=()=>{eo({label:"",line1:"",city:"",state:"",pincode:"",phone:""}),er(!0)},eu=()=>{es||er(!1)},em=e=>{let{name:l,value:t}=e.target;if("pincode"===l){let e=t.replace(/\D/g,"").slice(0,6);eo(l=>({...l,pincode:e}));return}if("phone"===l){let e=t.replace(/\D/g,"").slice(0,15);eo(l=>({...l,phone:e}));return}eo(e=>({...e,[l]:t}))},ep=async()=>{if(B(!0),!k){Z([]),U(null),B(!1);return}try{var e,l,t,a,n,r,s,i,d,o,c,u,p,h,x,v;let g=await fetch(E,{method:"GET",headers:{Accept:"application/json",Authorization:"Bearer ".concat(k)},cache:"no-store"}),y=(g.headers.get("content-type")||"").toLowerCase(),f=y.includes("application/json");if(401===g.status){Z([]),U(null),m.default.error("Please log in to view your addresses.");return}if(!g.ok||!f){Z([]),U(null);return}let b=await g.json(),j=Array.isArray(null==b?void 0:b.data)?b.data:Array.isArray(null==b?void 0:b.addresses)?b.addresses:Array.isArray(b)?b:[],w=j.map(m=>({id:null!==(t=null!==(l=null!==(e=m.id)&&void 0!==e?e:m._id)&&void 0!==l?l:m.uuid)&&void 0!==t?t:null,label:null!==(a=m.label)&&void 0!==a?a:"Address",line1:null!==(n=m.line1)&&void 0!==n?n:"",line2:null!==(r=m.line2)&&void 0!==r?r:"",city:null!==(s=m.city)&&void 0!==s?s:"",state:null!==(i=m.state)&&void 0!==i?i:"",pincode:null!==(o=null!==(d=m.pincode)&&void 0!==d?d:m.zip)&&void 0!==o?o:"",phone:null!==(u=null!==(c=m.phone)&&void 0!==c?c:m.mobile)&&void 0!==u?u:"",is_default:!0===(null!==(h=null!==(p=m.is_default)&&void 0!==p?p:m.default)&&void 0!==h&&h),...m}));if(Z(w),!J||!w.some(e=>e.id===J.id)){let e=null!==(v=null!==(x=w.find(e=>e.is_default))&&void 0!==x?x:w[0])&&void 0!==v?v:null;U(e)}}catch(e){Z([]),U(null)}finally{B(!1)}};(0,n.useEffect)(()=>{v&&k&&ep()},[v,k]),(0,n.useEffect)(()=>{M&&ep()},[M]),(0,n.useEffect)(()=>{k||(Z([]),U(null))},[k]);let eh=()=>R(!1),ex=e=>{var l;U(e),eh(),m.default.success("".concat(null!==(l=e.label)&&void 0!==l?l:"Address"," selected"))},ev=async e=>{var l,t,a,n,r,s,i;if(null==e||null===(l=e.preventDefault)||void 0===l||l.call(e),Q){$(!0);try{let e=await fetch(z(Q),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(k)},body:JSON.stringify({label:null!==(t=X.label)&&void 0!==t?t:"",line1:null!==(a=X.line1)&&void 0!==a?a:"",city:null!==(n=X.city)&&void 0!==n?n:"",state:null!==(r=X.state)&&void 0!==r?r:"",pincode:null!==(s=X.pincode)&&void 0!==s?s:"",phone:null!==(i=X.phone)&&void 0!==i?i:""})}),l=(e.headers.get("content-type")||"").toLowerCase();if(!e.ok){let l=await e.text().catch(()=>"");throw Error(l||"Update failed (".concat(e.status,")"))}if(l.includes("application/json")){let l=await e.json().catch(()=>null);if(l&&!1===l.status)throw Error((null==l?void 0:l.message)||"Update failed.")}m.default.success("Address updated"),K(!1),W(null),await ep()}catch(e){m.default.error((null==e?void 0:e.message)||"Failed to update address")}finally{$(!1)}}},eg=async e=>{var l,t;if(null==e||null===(l=e.preventDefault)||void 0===l||l.call(e),es)return;let a=["label","line1","city","state","pincode","phone"].filter(e=>!String(ed[e]||"").trim());if(a.length){m.default.error("Please fill: ".concat(a.join(", ")));return}if(!/^\d{6}$/.test(ed.pincode)){m.default.error("Pincode must be a valid 6-digit number.");return}if(!k){m.default.error("Please login to add an address.");return}ei(!0);let n=m.default.loading("Adding address...");try{let e=await fetch(T,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(k)},body:JSON.stringify({label:ed.label,line1:ed.line1,city:ed.city,state:ed.state,pincode:ed.pincode,phone:ed.phone})}),l=(e.headers.get("content-type")||"").toLowerCase();if(!e.ok){let l=await e.text().catch(()=>"");throw Error(l||"Add address failed (".concat(e.status,")"))}let a=null;if(l.includes("application/json")&&(a=await e.json().catch(()=>null))&&!1===a.status)throw Error((null==a?void 0:a.message)||"Server rejected the request.");if(m.default.dismiss(n),m.default.success("Address added successfully!"),await ep(),null==a?void 0:null===(t=a.data)||void 0===t?void 0:t.id){let e={...a.data||a.address};(null==e?void 0:e.id)&&U(e)}er(!1)}catch(e){m.default.dismiss(n),m.default.error((null==e?void 0:e.message)||"Failed to add address.")}finally{ei(!1)}},ey=async e=>{if(!(null==e?void 0:e.id))return;let l=window.confirm("Delete this address? This action cannot be undone.");if(l){G(e.id);try{let l=await fetch(q(e.id),{method:"DELETE",headers:{Accept:"application/json",Authorization:"Bearer ".concat(k)}});if(!l.ok){let e=await l.text().catch(()=>"");throw Error("Delete failed ".concat(l.status,": ").concat(e))}m.default.success("Address deleted"),await ep()}catch(e){m.default.error((null==e?void 0:e.message)||"Failed to delete address")}finally{G(null)}}},ef=e=>{if(null==e||""===e)return 0;let l=Number(String(e).replace(/,/g,""));return Number.isFinite(l)?Math.round(100*l):0},eb=e=>"₹".concat((Number.isFinite(e)?e/100:0).toFixed(2)),ej=e=>{let l=Number(null!=e?e:0);return Number.isFinite(l)?Math.max(0,Math.trunc(l)):0},ew=(0,n.useMemo)(()=>(null!=y?y:[]).map(e=>{var l,t,a;let n=ef(null!==(l=null==e?void 0:e.price)&&void 0!==l?l:0),r=ef(null!==(t=null==e?void 0:e.originalPrice)&&void 0!==t?t:0),s=ej(null!==(a=null==e?void 0:e.quantity)&&void 0!==a?a:0);return{item:e,pricePaise:n,originalPricePaise:r,quantity:s,subtotalPaise:n*s,savedTotalPaise:Math.max(0,r-n)*s}}),[y]),eN=(0,n.useMemo)(()=>ew.reduce((e,l)=>e+l.quantity,0),[ew]),eC=(0,n.useMemo)(()=>ew.reduce((e,l)=>e+l.subtotalPaise,0),[ew]),eS=(0,n.useMemo)(()=>ew.reduce((e,l)=>e+l.savedTotalPaise,0),[ew]);(0,n.useEffect)(()=>{if("undefined"==typeof document)return;let e=document.body.style.overflow;return v||M||H||en?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow=e||"unset"}},[v,M,H,en]);let ek=(e,l)=>null==f?void 0:f(e,Math.max(0,Math.trunc(l)-1)),e_=(e,l)=>null==f?void 0:f(e,Math.max(0,Math.trunc(l)+1)),eP=(0,n.useRef)({loaded:!1}),eA=()=>window.Razorpay?(eP.current.loaded=!0,Promise.resolve(!0)):(eP.current.promise||(eP.current.promise=new Promise(e=>{try{let l=document.createElement("script");l.src=p._g||"https://checkout.razorpay.com/v1/checkout.js",l.async=!0,l.onload=()=>{eP.current.loaded=!0,e(!0)},l.onerror=()=>e(!1),document.body.appendChild(l)}catch(l){e(!1)}})),eP.current.promise),eE=async function(e,l){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15e3,a=new AbortController,n=setTimeout(()=>a.abort(),t);try{let t=await fetch(e,{...null!=l?l:{},signal:a.signal});return clearTimeout(n),t}catch(e){throw clearTimeout(n),e}},eq=async(e,l,t)=>{var a,n,r,s,i,d,o,c,u,m,h,x;let v="".concat(p.I,"/admin/razorpay/order"),g=null!=l?l:ew.map(e=>{let{item:l,pricePaise:t,quantity:r,subtotalPaise:s}=e;return{id:null!==(a=null==l?void 0:l.id)&&void 0!==a?a:null,name:null!==(n=null==l?void 0:l.name)&&void 0!==n?n:"",quantity:r,unit_price_paise:t,unit_price_rupees:(t/100).toFixed(2),subtotal_paise:s}}),f={user:{id:null!==(r=null==_?void 0:_.id)&&void 0!==r?r:null,name:null!==(s=null==_?void 0:_.name)&&void 0!==s?s:null,email:null!==(i=null==_?void 0:_.email)&&void 0!==i?i:null,phone:null!==(d=null==_?void 0:_.phone)&&void 0!==d?d:null},payment:{provider:"razorpay",payment_id:null!==(o=null==e?void 0:e.razorpay_payment_id)&&void 0!==o?o:null,order_id:null!==(c=null==e?void 0:e.razorpay_order_id)&&void 0!==c?c:null,signature:null!==(u=null==e?void 0:e.razorpay_signature)&&void 0!==u?u:null,raw:null!=e?e:null},items:g,totals:{items_total_paise:eC,grand_total_paise:eC,total_savings_paise:eS,currency:"INR"},shipping_address:null!=J?J:null,address_id:null!==(m=null==J?void 0:J.id)&&void 0!==m?m:null,meta:null!=t?t:{notes:(null!=y?y:[]).map(e=>"".concat(null!==(h=null==e?void 0:e.name)&&void 0!==h?h:""," x").concat(null!==(x=null==e?void 0:e.quantity)&&void 0!==x?x:0)).join(", ")}},b={"Content-Type":"application/json",Accept:"application/json"};k&&(b.Authorization="Bearer ".concat(k));let j=await eE(v,{method:"POST",headers:b,body:JSON.stringify(f)});if(!j.ok){let e=await j.text().catch(()=>"");throw Error("submitOrderToServer failed ".concat(j.status,": ").concat(e))}return j.json()},ez=()=>{try{"function"==typeof j?j():localStorage.removeItem("cart")}catch(e){}},eT=async()=>{var e,l,t,a,n,r,s,i,d,o,c,u,p,h,x,v,f,b;if(!k){m.default.error("Please login to proceed to payment.");return}if(!y||0===y.length){m.default.error("Cart is empty.");return}if(!J){m.default.error("Please select a delivery address.");return}if(D)return;O(!0);let j=m.default.loading("Preparing payment...");try{let y=await eA();if(!y)throw Error("Failed to load Razorpay SDK.");let f=Math.round(eC/100),b=ew.map(i=>{let{item:d,pricePaise:o,quantity:c,subtotalPaise:u}=i;return{id:null!==(e=null==d?void 0:d.id)&&void 0!==e?e:null,sku:null!==(t=null!==(l=null==d?void 0:d.sku)&&void 0!==l?l:null==d?void 0:d.id)&&void 0!==t?t:null,name:null!==(a=null==d?void 0:d.name)&&void 0!==a?a:"",price_paise:o,price_rupees:(o/100).toFixed(2),quantity:c,subtotal_paise:u,image:null!==(r=null!==(n=null==d?void 0:d.imageUrl)&&void 0!==n?n:null==d?void 0:d.image)&&void 0!==r?r:null,meta:null!==(s=null==d?void 0:d.meta)&&void 0!==s?s:null}}),N={"Content-Type":"application/json",Accept:"application/json"};k&&(N.Authorization="Bearer ".concat(k));let C=await eE(P,{method:"POST",headers:N,body:JSON.stringify({amount:f})},15e3);if(!C.ok){let e=await C.text().catch(()=>"");throw Error("Create order failed ".concat(C.status,": ").concat(e))}let S=await C.json();if(!S||!(!0===S.status||!0===S.success||S.data))throw Error("Server failed to create Razorpay order: "+((null==S?void 0:S.message)||JSON.stringify(S)));let E=null!==(i=S.data)&&void 0!==i?i:S,q=null!==(d=E.key)&&void 0!==d?d:S.key,z=null!==(o=E.amount)&&void 0!==o?o:S.amount,T=null!==(c=E.currency)&&void 0!==c?c:"INR",D=null!==(p=null!==(u=E.order_id)&&void 0!==u?u:E.id)&&void 0!==p?p:S.order_id;if(!q||!D)throw Error("Invalid create-order response from server (missing key/order_id).");m.default.dismiss(j);let M=null!=z?Math.round(100*Number(z)):Math.round(100*f),R={key:q,amount:M,currency:T,name:"RayFog Business Solutions",description:"Order of ".concat(eN," item(s)"),order_id:D,handler:async function(e){let l=m.default.loading("Verifying payment with server...");try{var t,a,n,r,s;let i={...e,order_id:D,amount:f,amount_unit:"rupees",currency:T,items:b,totals:{items_total_paise:eC,grand_total_paise:eC,total_savings_paise:eS,items_count:eN},user:{id:null!==(t=null==_?void 0:_.id)&&void 0!==t?t:null,name:null!==(a=null==_?void 0:_.name)&&void 0!==a?a:null,email:null!==(n=null==_?void 0:_.email)&&void 0!==n?n:null,phone:null!==(r=null==_?void 0:_.phone)&&void 0!==r?r:null},shipping_address:J,notes:{source:"web_checkout"}},d={"Content-Type":"application/json",Accept:"application/json"};k&&(d.Authorization="Bearer ".concat(k));let o=await eE(A,{method:"POST",headers:d,body:JSON.stringify(i)},15e3);if(!o.ok){let e=await o.text().catch(()=>"");throw Error("Verify failed ".concat(o.status,": ").concat(e))}let c=await o.json();if(c&&(!0===c.status||!0===c.success)){m.default.dismiss(l),m.default.success("✅ Payment successful & verified!",{duration:4e3});try{await eq(e,b,{created_by:"client_fallback",address_id:null==J?void 0:J.id})}catch(e){}try{ez()}catch(e){}I.current&&O(!1),null==g||g(),null==w||w()}else{m.default.dismiss(l);let e=null!==(s=null==c?void 0:c.message)&&void 0!==s?s:"Payment verification failed on server.";m.default.error("❌ ".concat(e)),I.current&&O(!1)}}catch(e){m.default.dismiss(),m.default.error("Verification failed: "+((null==e?void 0:e.message)||"unknown")),I.current&&O(!1)}},prefill:{name:null!==(h=null==_?void 0:_.name)&&void 0!==h?h:"Customer",email:null!==(x=null==_?void 0:_.email)&&void 0!==x?x:"",contact:null!==(v=null==_?void 0:_.phone)&&void 0!==v?v:""},theme:{color:"#0d6efd"}};if(!window.Razorpay)throw Error("Razorpay SDK not available on window.");let F=new window.Razorpay(R);F&&"function"==typeof F.on&&F.on("payment.failed",function(e){var l,t;let a=(null==e?void 0:null===(l=e.error)||void 0===l?void 0:l.description)||(null==e?void 0:null===(t=e.error)||void 0===t?void 0:t.reason)||"Payment failed";m.default.dismiss(),m.default.error("❌ Payment failed: "+a),I.current&&O(!1)}),F.open()}catch(l){m.default.dismiss();let e=null!==(b=null!==(f=null==l?void 0:l.message)&&void 0!==f?f:String(l))&&void 0!==b?b:"Payment failed to start.";m.default.error(e),I.current&&O(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.Toaster,{position:"top-right"}),(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 z-40 transition-opacity duration-300 ".concat(v?"opacity-100":"opacity-0 pointer-events-none"),onClick:g,"aria-hidden":!v}),(0,a.jsxs)("aside",{className:"fixed top-0 right-0 h-full w-96 bg-white z-50 transform transition-transform duration-300 ease-in-out ".concat(v?"translate-x-0":"translate-x-full"," flex flex-col"),role:"dialog","aria-hidden":!v,children:[(0,a.jsxs)("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"My Cart"}),(0,a.jsx)("button",{onClick:g,className:"p-2 rounded hover:bg-gray-100","aria-label":"Close cart",children:(0,a.jsx)(r.Z,{className:"w-5 h-5 text-gray-600"})})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto",children:y&&0!==y.length?(0,a.jsx)("div",{className:"p-4 space-y-4",children:ew.map((e,l)=>{var t,n,r,d,o;let{item:c,quantity:u,subtotalPaise:m}=e,p=null!==(n=null!==(t=null==c?void 0:c.imageUrl)&&void 0!==t?t:null==c?void 0:c.image)&&void 0!==n?n:"";return(0,a.jsxs)("div",{className:"flex items-start space-x-3 bg-gray-50 p-3 rounded-lg",children:[(0,a.jsx)("img",{src:p,alt:null!==(r=null==c?void 0:c.name)&&void 0!==r?r:"item",className:"w-12 h-12 object-cover rounded-lg",onError:e=>{e.currentTarget.src=""}}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h3",{className:"font-medium text-sm text-gray-900 line-clamp-2",children:null!==(d=null==c?void 0:c.name)&&void 0!==d?d:"Unnamed"}),(null==c?void 0:c.weight)&&(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:c.weight})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center bg-green-600 text-white rounded-lg",children:[(0,a.jsx)("button",{onClick:()=>ek(c.id,u),className:"p-1 hover:bg-green-700 rounded-l-lg","aria-label":"Decrease quantity",children:(0,a.jsx)(s.Z,{className:"w-3 h-3"})}),(0,a.jsx)("span",{className:"px-2 text-sm font-medium",children:u}),(0,a.jsx)("button",{onClick:()=>e_(c.id,u),className:"p-1 hover:bg-green-700 rounded-r-lg","aria-label":"Increase quantity",children:(0,a.jsx)(i.Z,{className:"w-3 h-3"})})]}),(0,a.jsx)("div",{className:"text-right",children:(0,a.jsx)("div",{className:"font-bold text-sm",children:eb(m)})})]})]},String(null!==(o=null==c?void 0:c.id)&&void 0!==o?o:"idx-".concat(l)))})}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full p-6",children:(0,a.jsx)("p",{className:"text-gray-500",children:"Your cart is empty"})})}),y&&y.length>0&&(0,a.jsx)("div",{className:"border-t border-gray-200",children:(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900",children:"Bill details"}),k&&(0,a.jsxs)("button",{onClick:()=>R(!0),className:"inline-flex items-center space-x-2 px-3 py-1.5 rounded-lg border border-gray-200 hover:bg-gray-50 text-sm","aria-expanded":M,children:[(0,a.jsx)(i.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:J?"Change address":"Select address"})]})]}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Items total"}),(0,a.jsx)("span",{className:"font-semibold",children:eb(eC)})]}),(0,a.jsx)("div",{className:"border-t border-gray-200 pt-2 mt-3",children:(0,a.jsxs)("div",{className:"flex justify-between font-bold text-lg",children:[(0,a.jsx)("span",{children:"Grand total"}),(0,a.jsx)("span",{children:eb(eC)})]})})]}),(0,a.jsx)("div",{className:"mt-4 p-3 rounded-lg",children:J?(0,a.jsxs)("div",{className:"bg-gray-50 p-3 rounded",children:[(e=>{var l;if(!e)return null;let t=[e.line1,e.line2,e.city?"".concat(e.city).concat(e.pincode?" - "+e.pincode:""):null,e.state].filter(Boolean).join(", "),n=e.phone?"Phone: ".concat(e.phone):"";return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-sm",children:null!==(l=e.label)&&void 0!==l?l:"Selected address"}),(0,a.jsx)("div",{className:"text-xs text-gray-700",children:t}),n&&(0,a.jsx)("div",{className:"text-xs text-gray-600 mt-1",children:n})]})})(J),(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)("button",{onClick:()=>R(!0),className:"text-xs underline",children:"Change address"})})]}):(0,a.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 text-yellow-800 text-xs p-3 rounded",children:["No address selected. Click “",k?"Add address":"Login","” to choose one."]})}),(0,a.jsxs)("button",{onClick:eT,className:"w-full py-4 rounded-lg font-semibold text-lg mt-4 flex items-center justify-around ".concat(k?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-300 text-gray-600 cursor-not-allowed"),disabled:!k||D,children:[(0,a.jsx)("span",{children:eb(eC)}),(0,a.jsx)("span",{children:k?D?"Processing...":"Pay with Razorpay":"Login to Proceed"})]})]})})]}),M&&(0,a.jsxs)("div",{role:"dialog","aria-modal":"true",className:"fixed inset-0 z-50 flex items-center justify-center px-4 py-8",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/60",onClick:()=>R(!1),"aria-hidden":"true"}),(0,a.jsxs)("div",{className:"relative w-full max-w-lg bg-white rounded-lg shadow-xl z-10 overflow-hidden",children:[(0,a.jsxs)("div",{className:"p-4 border-b flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-base font-semibold",children:"Select address"}),(0,a.jsx)("button",{onClick:()=>R(!1),className:"p-2 rounded hover:bg-gray-100","aria-label":"Close",children:(0,a.jsx)(r.Z,{className:"w-4 h-4"})})]}),(0,a.jsxs)("div",{className:"p-4 max-h-80 overflow-y-auto space-y-3",children:[L&&(0,a.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0].map((e,l)=>(0,a.jsx)("div",{className:"animate-pulse h-16 bg-gray-100 rounded"},l))}),!L&&0===F.length&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"No saved addresses found."}),(0,a.jsx)("button",{onClick:ec,className:"px-4 py-2 rounded bg-green-600 text-white font-medium hover:bg-green-700 text-sm",children:"Add address"})]}),!L&&F.length>0&&F.map((e,l)=>{var t,n;let r=[e.line1,e.line2,e.city?"".concat(e.city).concat(e.pincode?" - "+e.pincode:""):null,e.state].filter(Boolean).join(", "),s=(null==J?void 0:J.id)===e.id;return(0,a.jsx)("label",{className:"block border rounded p-3 cursor-pointer hover:bg-gray-50 ".concat(s?"border-green-400 ring-1 ring-green-200":"border-gray-200"),children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"font-medium",children:[null!==(t=e.label)&&void 0!==t?t:"Address"," ",e.is_default?(0,a.jsx)("span",{className:"ml-2 text-xs text-green-600",children:"(Default)"}):null]}),(0,a.jsx)("div",{className:"text-xs text-gray-700 mt-1",children:r}),e.phone&&(0,a.jsxs)("div",{className:"text-xs text-gray-600 mt-1",children:["Phone: ",e.phone]})]}),(0,a.jsxs)("div",{className:"ml-3 flex flex-col items-end",children:[(0,a.jsx)("input",{type:"radio",name:"selected_address",checked:!!s,onChange:()=>ex(e),className:"w-4 h-4 mb-2"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:l=>{l.preventDefault(),l.stopPropagation(),el(e)},className:"p-1 rounded hover:bg-gray-100",title:"Edit address","aria-label":"Edit address",children:(0,a.jsx)(d.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{type:"button",onClick:l=>{l.preventDefault(),l.stopPropagation(),V||ey(e)},className:"p-1 rounded hover:bg-gray-100 ".concat(V===e.id?"opacity-50 pointer-events-none":""),title:"Delete address","aria-label":"Delete address",disabled:V===e.id,children:(0,a.jsx)(o.Z,{className:"w-4 h-4"})})]})]})]})},null!==(n=e.id)&&void 0!==n?n:l)})]}),(0,a.jsxs)("div",{className:"p-4 border-t flex items-center justify-between",children:[(0,a.jsx)("button",{onClick:()=>R(!1),className:"px-3 py-1.5 rounded border hover:bg-gray-50 text-sm",children:"Close"}),(0,a.jsx)("button",{onClick:ec,className:"px-3 py-1.5 rounded bg-green-600 text-white hover:bg-green-700 text-sm",children:"Add new"})]})]})]}),H&&(0,a.jsxs)("div",{role:"dialog","aria-modal":"true",className:"fixed inset-0 z-[60] flex items-center justify-center px-4 py-8",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/60",onClick:et,"aria-hidden":"true"}),(0,a.jsxs)("div",{className:"relative w-full max-w-md bg-white rounded-lg shadow-xl z-10 overflow-hidden",children:[(0,a.jsxs)("div",{className:"p-4 border-b flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-base font-semibold",children:"Edit address"}),(0,a.jsx)("button",{onClick:et,className:"p-2 rounded hover:bg-gray-100","aria-label":"Close",children:(0,a.jsx)(r.Z,{className:"w-4 h-4"})})]}),(0,a.jsxs)("form",{onSubmit:ev,className:"p-4 space-y-3",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"Label"}),(0,a.jsx)("input",{name:"label",value:X.label,onChange:ea,className:"w-full border rounded px-3 py-2 text-sm",placeholder:"Home / Office",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"Address line"}),(0,a.jsx)("input",{name:"line1",value:X.line1,onChange:ea,className:"w-full border rounded px-3 py-2 text-sm",placeholder:"Street, area",required:!0})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"City"}),(0,a.jsx)("input",{name:"city",value:X.city,onChange:ea,className:"w-full border rounded px-3 py-2 text-sm",placeholder:"City",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"State"}),(0,a.jsx)("input",{name:"state",value:X.state,onChange:ea,className:"w-full border rounded px-3 py-2 text-sm",placeholder:"State",required:!0})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"Pincode"}),(0,a.jsx)("input",{name:"pincode",value:X.pincode,onChange:ea,className:"w-full border rounded px-3 py-2 text-sm",placeholder:"e.g. 500055",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"Phone"}),(0,a.jsx)("input",{name:"phone",value:X.phone,onChange:ea,className:"w-full border rounded px-3 py-2 text-sm",placeholder:"e.g. 9874563210",required:!0})]})]})]}),(0,a.jsxs)("div",{className:"pt-2 flex items-center justify-end gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:et,className:"px-3 py-2 rounded border hover:bg-gray-50 text-sm",disabled:Y,children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 rounded text-white text-sm ".concat(Y?"bg-green-400":"bg-green-600 hover:bg-green-700"),disabled:Y,children:Y?"Saving...":"Save changes"})]})]})]})]}),en&&(0,a.jsxs)("div",{role:"dialog","aria-modal":"true",className:"fixed inset-0 z-[60] flex items-center justify-center px-4 py-8",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/60",onClick:eu,"aria-hidden":"true"}),(0,a.jsxs)("div",{className:"relative w-full max-w-md bg-white rounded-lg shadow-xl z-10 overflow-hidden",children:[(0,a.jsxs)("div",{className:"p-4 border-b flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-base font-semibold",children:"Add new address"}),(0,a.jsx)("button",{onClick:eu,className:"p-2 rounded hover:bg-gray-100","aria-label":"Close",children:(0,a.jsx)(r.Z,{className:"w-4 h-4"})})]}),(0,a.jsxs)("form",{onSubmit:eg,className:"p-4 space-y-3",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"Label"}),(0,a.jsx)("input",{name:"label",value:ed.label,onChange:em,className:"w-full border rounded px-3 py-2 text-sm",placeholder:"Home / Office",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"Address line"}),(0,a.jsx)("input",{name:"line1",value:ed.line1,onChange:em,className:"w-full border rounded px-3 py-2 text-sm",placeholder:"Street, area",required:!0})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"City"}),(0,a.jsx)("input",{name:"city",value:ed.city,onChange:em,className:"w-full border rounded px-3 py-2 text-sm",placeholder:"City",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"State"}),(0,a.jsx)("input",{name:"state",value:ed.state,onChange:em,className:"w-full border rounded px-3 py-2 text-sm",placeholder:"State",required:!0})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"Pincode"}),(0,a.jsx)("input",{name:"pincode",value:ed.pincode,onChange:em,className:"w-full border rounded px-3 py-2 text-sm",placeholder:"e.g. 500067",required:!0,inputMode:"numeric",pattern:"\\d{6}",title:"Enter 6 digit pincode"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"Phone"}),(0,a.jsx)("input",{name:"phone",value:ed.phone,onChange:em,className:"w-full border rounded px-3 py-2 text-sm",placeholder:"e.g. 9874563210",required:!0,inputMode:"tel"})]})]})]}),(0,a.jsxs)("div",{className:"pt-2 flex items-center justify-end gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:eu,className:"px-3 py-2 rounded border hover:bg-gray-50 text-sm",disabled:es,children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 rounded text-white text-sm ".concat(es?"bg-green-400":"bg-green-600 hover:bg-green-700"),disabled:es,children:es?"Saving...":"Add address"})]})]})]})]})]})}},7516:function(e,l,t){t.d(l,{Z:function(){return o}});var a=t(7437),n=t(2265),r=t(3067),s=t(2549),i=t(2502),d=t(8207);function o(e){let{isOpen:l,onClose:t}=e,o=(0,i.useAuth)(),[c,u]=(0,n.useState)("login"),[m,p]=(0,n.useState)(""),[h,x]=(0,n.useState)(""),[v,g]=(0,n.useState)(""),[y,f]=(0,n.useState)(""),[b,j]=(0,n.useState)(""),[w,N]=(0,n.useState)(""),[C,S]=(0,n.useState)(null),[k,_]=(0,n.useState)(null),[P,A]=(0,n.useState)(!1),E=()=>{p(""),x(""),g(""),f(""),j(""),N(""),S(null),_(null)},q=()=>{E(),t()};async function z(e){try{return await e.json()}catch(e){return null}}let T=async e=>{if(e.preventDefault(),_(null),!h||!v){_("Please enter email and password.");return}A(!0);try{let e=await o.login(h.trim().toLowerCase(),v);if(A(!1),!e){_("Invalid credentials. Please try again.");return}q()}catch(e){A(!1),_("Login failed. Please try again.")}},D=async e=>{if(e.preventDefault(),_(null),!m||!h||!v||!y){_("All fields (including contact) are required.");return}if(v.length<6){_("Password must be at least 6 characters.");return}A(!0);try{let e=await o.signup(m.trim(),h.trim().toLowerCase(),v,y.trim());if(A(!1),!e){_("Signup failed. Please try again.");return}q()}catch(e){A(!1),_("Signup failed. Please try again.")}},O=async e=>{if(e.preventDefault(),_(null),S(null),!b){_("Enter the email to reset.");return}if(!w||w.length<6){_("New password must be at least 6 characters.");return}try{A(!0);let e=await fetch("".concat(d.ZP,"/api/auth/reset"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:b.trim().toLowerCase(),newPassword:w})});if(A(!1),!e.ok){let l=await z(e);_((null==l?void 0:l.message)||"Reset failed (".concat(e.status,")"));return}S("Password updated. You can now log in with the new password."),u("login"),x(b.trim().toLowerCase()),g(w),j(""),N("")}catch(e){A(!1),_("Network error while resetting password.")}};return l?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl w-full max-w-md relative",children:[(0,a.jsxs)("div",{className:"flex items-center p-4 border-b border-gray-100",children:["login"!==c&&(0,a.jsx)("button",{onClick:()=>{u("login"),_(null),S(null)},className:"p-2 rounded-lg hover:bg-gray-100 mr-2",children:(0,a.jsx)(r.Z,{className:"h-5 w-5 text-gray-600"})}),(0,a.jsx)("div",{className:"flex-1"}),(0,a.jsx)("button",{onClick:q,className:"p-2 rounded-lg hover:bg-gray-100",children:(0,a.jsx)(s.Z,{className:"h-5 w-5 text-gray-600"})})]}),(0,a.jsxs)("div",{className:"p-6 text-center",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-1",children:"login"===c?"Log in":"signup"===c?"Create account":"Reset password"}),"login"===c&&(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"Sign in to continue."}),"signup"===c&&(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"Create a new account"}),"reset"===c&&(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"Enter your email and new password"}),k&&(0,a.jsx)("div",{className:"text-red-600 text-sm mb-3",children:k}),C&&(0,a.jsx)("div",{className:"text-green-600 text-sm mb-3",children:C}),"login"===c&&(0,a.jsxs)("form",{onSubmit:T,className:"space-y-4",children:[(0,a.jsx)("input",{type:"email",placeholder:"Email address",value:h,onChange:e=>x(e.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-lg",required:!0}),(0,a.jsx)("input",{type:"password",placeholder:"Password",value:v,onChange:e=>g(e.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-lg",required:!0}),(0,a.jsx)("button",{type:"submit",disabled:P,className:"w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold",children:P?"Signing in...":"Sign in"}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[(0,a.jsx)("button",{type:"button",className:"underline",onClick:()=>{u("reset"),_(null)},children:"Forgot password?"}),(0,a.jsx)("button",{type:"button",className:"underline",onClick:()=>{u("signup"),_(null)},children:"Create account"})]})]}),"signup"===c&&(0,a.jsxs)("form",{onSubmit:D,className:"space-y-4",children:[(0,a.jsx)("input",{type:"text",placeholder:"Full name",value:m,onChange:e=>p(e.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-lg",required:!0}),(0,a.jsx)("input",{type:"email",placeholder:"Email address",value:h,onChange:e=>x(e.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-lg",required:!0}),(0,a.jsx)("input",{type:"text",placeholder:"Contact (phone)",value:y,onChange:e=>f(e.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-lg",required:!0}),(0,a.jsx)("input",{type:"password",placeholder:"Password (min 6 chars)",value:v,onChange:e=>g(e.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-lg",required:!0}),(0,a.jsx)("button",{type:"submit",disabled:P,className:"w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold",children:P?"Creating...":"Create account"}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["Already have an account?"," ",(0,a.jsx)("button",{onClick:()=>{u("login"),_(null)},className:"underline",children:"Sign in"})]})]}),"reset"===c&&(0,a.jsxs)("form",{onSubmit:O,className:"space-y-4",children:[(0,a.jsx)("input",{type:"email",placeholder:"Email address",value:b,onChange:e=>j(e.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-lg",required:!0}),(0,a.jsx)("input",{type:"password",placeholder:"New password (min 6 chars)",value:w,onChange:e=>N(e.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-lg",required:!0}),(0,a.jsx)("button",{type:"submit",disabled:P,className:"w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold",children:P?"Updating...":"Update password"}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["Remembered password?"," ",(0,a.jsx)("button",{onClick:()=>{u("login"),_(null)},className:"underline",children:"Sign in"})]})]})]})]})}):null}},8822:function(e,l,t){t.r(l),t.d(l,{CartProvider:function(){return s},useCart:function(){return i}});var a=t(7437),n=t(2265);let r=(0,n.createContext)(null);function s(e){let{children:l}=e,[t,s]=(0,n.useState)(()=>{try{let e=localStorage.getItem("cart_v1");return e?JSON.parse(e):[]}catch(e){return[]}});(0,n.useEffect)(()=>{try{localStorage.setItem("cart_v1",JSON.stringify(t))}catch(e){}},[t]);let i=(0,n.useCallback)(e=>{var l;if(!e||!e.id)return;let t=Math.max(1,Number(null!==(l=e.quantity)&&void 0!==l?l:1));s(l=>{let a=l.findIndex(l=>l.id===e.id);if(a>=0){let e=[...l];return e[a]={...e[a],quantity:(Number(e[a].quantity)||0)+t},e}return[...l,{...e,quantity:t}]})},[]),d=(0,n.useCallback)(e=>{s(l=>l.filter(l=>l.id!==e))},[]),o=(0,n.useCallback)((e,l)=>{let t=Math.trunc(Number(l)||0);s(l=>t<=0?l.filter(l=>l.id!==e):l.map(l=>l.id===e?{...l,quantity:t}:l))},[]),c=(0,n.useCallback)(()=>s([]),[]),u=t.reduce((e,l)=>e+(Number(l.quantity)||0),0),m=t.reduce((e,l)=>e+(Number(l.price)||0)*(Number(l.quantity)||0),0);return(0,a.jsx)(r.Provider,{value:{items:t,addItem:i,removeItem:d,updateQuantity:o,clearCart:c,cartCount:u,cartTotal:m},children:l})}function i(){let e=(0,n.useContext)(r);if(!e)throw Error("useCart must be used within CartProvider");return e}},81:function(e,l,t){t.r(l),t.d(l,{CategoryDataProvider:function(){return d},useCategoryDataContext:function(){return o}});var a=t(7437),n=t(2265),r=t(4829);let s=(0,n.createContext)(void 0);async function i(){try{var e,l,t;let a=await r.Z.get("https://9nutsapi.nearbydoctors.in/public/api/category/show"),n=null!==(t=null!==(l=null==a?void 0:null===(e=a.data)||void 0===e?void 0:e.data)&&void 0!==l?l:null==a?void 0:a.data)&&void 0!==t?t:a,s=[];if(Array.isArray(n))s=n;else if(Array.isArray(n.data))s=Array.isArray(n.data.data)?n.data.data:n.data;else{let e=Object.values(n||{}).find(e=>Array.isArray(e));Array.isArray(e)&&(s=e)}return s}catch(e){throw e}}function d(e){let{children:l}=e,[t,r]=(0,n.useState)([]),[d,o]=(0,n.useState)(!1),[c,u]=(0,n.useState)(null),m=(0,n.useCallback)(async()=>{o(!0),u(null);try{let e=await i(),l=(e||[]).map(e=>{var l,t,a,n,r,s,i,d,o,c,u,m;let p=String(null!==(i=null!==(s=null!==(r=null!==(n=null!==(a=e.id)&&void 0!==a?a:e._id)&&void 0!==n?n:e.category_id)&&void 0!==r?r:e.categoryId)&&void 0!==s?s:null===(t=e.id)||void 0===t?void 0:null===(l=t.toString)||void 0===l?void 0:l.call(t))&&void 0!==i?i:"").trim(),h=String(null!==(m=null!==(u=null!==(c=null!==(o=null!==(d=e.name)&&void 0!==d?d:e.title)&&void 0!==o?o:e.label)&&void 0!==c?c:e.category_name)&&void 0!==u?u:p)&&void 0!==m?m:"");return p?{id:p,name:h}:null}).filter(Boolean),t={};l.forEach(e=>t[e.id]=e),r(Object.values(t))}catch(l){var e;r([]),u(String(null!==(e=null==l?void 0:l.message)&&void 0!==e?e:"Failed to load categories"))}finally{o(!1)}},[]);return(0,n.useEffect)(()=>{m()},[m]),(0,a.jsx)(s.Provider,{value:{categories:t,loading:d,error:c,refreshCategories:m},children:l})}function o(){let e=(0,n.useContext)(s);if(!e)throw Error("useCategoryDataContext must be used within a CategoryDataProvider");return e}}}]);