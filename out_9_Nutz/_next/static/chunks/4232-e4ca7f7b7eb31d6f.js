"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4232],{4232:function(t,e,i){i.r(e),i.d(e,{ProductProvider:function(){return g},useProducts:function(){return u}});var r=i(7437),a=i(2265),o=i(2502),n=i(8207),d=i(4829);let c=(0,a.createContext)(void 0),u=()=>{let t=(0,a.useContext)(c);if(!t)throw Error("useProducts must be used within a ProductProvider");return t};function l(t){if("number"==typeof t)return t;if("string"==typeof t){let e=Number.parseFloat(t.replace(/,/g,""));return Number.isFinite(e)?e:0}return 0}let s=(n.I||"").replace(/\/+$/,""),p=s.includes("/public")?s:"".concat(s,"/public");function v(t){if(!t)return;let e=String(t).trim();if(!e)return;if(/^https?:\/\//i.test(e))return e;let i=e.replace(/^\/+/,"");return/^storage\//i.test(i)||/\/storage\//i.test(i)?"".concat(s,"/").concat(i):"".concat(p,"/storage/").concat(i)}function m(t){var e,i,r,a,o,n,d,c,u,s,p,m,g,f,y,h;if(!t)return null;let _=l(t.price),w=void 0!==t.discount_price&&null!==t.discount_price?l(t.discount_price):void 0,S=void 0!==t.discount_amount&&null!==t.discount_amount?l(t.discount_amount):void 0,b=void 0!==t.discount_percent&&null!==t.discount_percent?l(t.discount_percent):void 0,A=null!==(e=t.stock)&&void 0!==e?e:0,k=Number.isFinite(Number(A))?Number(A):l(A),E=t.category?{id:String(null!==(i=t.category.id)&&void 0!==i?i:""),name:String(null!==(r=t.category.name)&&void 0!==r?r:""),imageUrl:t.category.image_url?String(t.category.image_url):t.category.image?v(t.category.image):void 0}:void 0,F=Array.isArray(t.images)&&t.images.length>0?t.images.map(t=>({id:null!==(a=null==t?void 0:t.id)&&void 0!==a?a:void 0,product_id:null!==(o=null==t?void 0:t.product_id)&&void 0!==o?o:void 0,image:null!==(n=null==t?void 0:t.image)&&void 0!==n?n:void 0,image_url:null!==(d=null==t?void 0:t.image_url)&&void 0!==d?d:(null==t?void 0:t.image)?v(t.image):void 0,raw:t})):[],N=F.map(t=>null!==(c=t.image_url)&&void 0!==c?c:t.image?v(t.image):void 0).filter(Boolean),P=t.image_url&&String(t.image_url)||(N.length>0?N[0]:t.image?v(t.image):void 0),C=null;if(t.video_url)C=t.video_url;else if(t.video)C=t.video;else if(Array.isArray(t.videos)&&t.videos.length){let e=t.videos[0];"string"==typeof e?C=e:e&&"object"==typeof e&&(C=null!==(m=null!==(p=null!==(s=null!==(u=e.video_url)&&void 0!==u?u:e.url)&&void 0!==s?s:e.path)&&void 0!==p?p:e.video)&&void 0!==m?m:null)}let x=C?String(C).trim().startsWith("http")?String(C).trim():v(C):void 0;return{id:String(null!==(g=t.id)&&void 0!==g?g:""),name:String(null!==(f=t.name)&&void 0!==f?f:""),category:E,grams:t.grams?String(t.grams):void 0,description:null!==(y=t.description)&&void 0!==y?y:void 0,price:_,imageUrl:null!=P?P:void 0,image:null!==(h=t.image)&&void 0!==h?h:void 0,images:F,imagesUrls:N,discountPrice:"number"==typeof w?w:void 0,discountAmount:"number"==typeof S?S:void 0,discountPercent:"number"==typeof b?b:void 0,vendorId:void 0!==t.vendor_id&&null!==t.vendor_id?String(t.vendor_id):void 0,stock:Number.isFinite(Number(k))?Number(k):0,createdAt:t.created_at?new Date(t.created_at):void 0,updatedAt:t.updated_at?new Date(t.updated_at):void 0,isOutOfStock:(Number.isFinite(Number(k))?Number(k):0)<=0,videoUrl:x,raw:t}}let g=t=>{var e;let{children:i}=t,{token:u}=null!==(e=null===o.useAuth||void 0===o.useAuth?void 0:(0,o.useAuth)())&&void 0!==e?e:{},[l,p]=(0,a.useState)([]),v=(0,a.useCallback)(async()=>{try{var t;let e=await d.Z.get("".concat(n.I,"/product/show")),i=null!==(t=e.data)&&void 0!==t?t:e,r=Array.isArray(null==i?void 0:i.data)?i.data:Array.isArray(i)?i:[],a=r.map(t=>m(t)).filter(Boolean);p(a)}catch(t){console.error("reload products failed",t),p([])}},[]);(0,a.useEffect)(()=>{v()},[v]);let g=t=>{var e;let i=new FormData;if(t.name&&i.append("name",String(t.name)),t.description&&i.append("description",String(null!==(e=t.description)&&void 0!==e?e:"")),void 0!==t.price&&i.append("price",String(t.price)),void 0!==t.discount_price&&i.append("discount_price",String(t.discount_price)),t.category_id&&i.append("category_id",String(t.category_id)),void 0!==t.stock&&i.append("stock",String(t.stock||0)),t.imageFile&&i.append("image",t.imageFile),t.imageFiles&&Array.isArray(t.imageFiles)&&t.imageFiles.forEach(t=>{i.append("images[]",t)}),Array.isArray(t.images)){let e=t.images.map(t=>String(t||"").trim()).filter(t=>/^https?:\/\//i.test(t));e.length&&i.append("images_urls",JSON.stringify(e))}return i},f=(0,a.useCallback)(async t=>{var e;let i=g(t),r=await fetch("".concat(s,"/api/admin/products"),{method:"POST",body:i});if(!r.ok){let t=await r.text().catch(()=>"");throw Error("Add product failed ".concat(r.status,": ").concat(t||r.statusText))}let a=await r.json(),o=null!==(e=null==a?void 0:a.data)&&void 0!==e?e:a,n=m(o);return p(t=>[n,...t]),window.dispatchEvent(new CustomEvent("productsUpdated")),n},[]),y=(0,a.useCallback)(async(t,e)=>{var i,r;let a=e.imageFile&&e.imageFile instanceof File||Array.isArray(e.imageFiles)&&e.imageFiles.length>0,o="".concat(s,"/api/admin/products/").concat(t);if(a){let r=g(e),a=await fetch(o,{method:"POST",body:r});if(!a.ok){let t=await a.text().catch(()=>"");throw Error("Update product failed ".concat(a.status,": ").concat(t||a.statusText))}let n=await a.json(),d=null!==(i=null==n?void 0:n.data)&&void 0!==i?i:n,c=m(d);return p(e=>e.map(e=>e.id===String(t)?c:e)),window.dispatchEvent(new CustomEvent("productsUpdated")),c}let n={name:e.name,price:e.price,discount_price:e.discount_price,stock:e.stock,category_id:e.category_id},d=await fetch(o,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!d.ok){let t=await d.text().catch(()=>"");throw Error("Update product failed ".concat(d.status,": ").concat(t||d.statusText))}let c=await d.json(),u=null!==(r=null==c?void 0:c.data)&&void 0!==r?r:c,l=m(u);return p(e=>e.map(e=>e.id===String(t)?l:e)),window.dispatchEvent(new CustomEvent("productsUpdated")),l},[]),h=(0,a.useCallback)(async t=>{let e="".concat(s,"/api/admin/products/").concat(t),i=await fetch(e,{method:"DELETE"});if(!i.ok){let t=await i.text().catch(()=>"");throw Error("Delete product failed ".concat(i.status,": ").concat(t||i.statusText))}p(e=>e.filter(e=>e.id!==String(t))),window.dispatchEvent(new CustomEvent("productsUpdated"))},[]);return(0,r.jsx)(c.Provider,{value:{products:l,reload:v,addProduct:f,updateProduct:y,deleteProduct:h,getProductById:t=>l.find(e=>e.id===String(t)),getActiveProducts:()=>l.filter(t=>!t.isOutOfStock)},children:i})}}}]);