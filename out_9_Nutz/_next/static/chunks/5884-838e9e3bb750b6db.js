"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5884],{2502:function(e,t,r){r.r(t),r.d(t,{AuthProvider:function(){return p},useAuth:function(){return f}});var o=r(7437),l=r(2265),n=r(5925),i=r(8207),a=r(4033),u=r(4829),s=r(2601);let d=(s.env.NEXT_PUBLIC_API_BASE_URL||s.env.PROD_API_URL||"https://9nutsapi.nearbydoctors.in/public/api/").replace(/\/+$/,""),c=u.Z.create({baseURL:d,headers:{"Content-Type":"application/json"}});c.interceptors.request.use(e=>{{let t=window.localStorage.getItem("token");t&&(e.headers.Authorization="Bearer ".concat(t))}return e},e=>Promise.reject(e)),c.interceptors.response.use(e=>e,e=>Promise.reject(e));let v=(0,l.createContext)(void 0),f=()=>{let e=(0,l.useContext)(v);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},h=i.I,p=e=>{let{children:t}=e,[r,i]=(0,l.useState)(null),[u,s]=(0,l.useState)(!0),[d,c]=(0,l.useState)(null),f=(0,a.useRouter)();function p(e,t){e?localStorage.setItem("token",e):localStorage.removeItem("token"),t?localStorage.setItem("user",JSON.stringify(t)):localStorage.removeItem("user"),c(e),i(t)}(0,l.useEffect)(()=>{(async()=>{try{let e=localStorage.getItem("token");if(e){let t=localStorage.getItem("user");t&&i(JSON.parse(t)),c(e)}}catch(e){}finally{s(!1)}})()},[]);let y=async(e,t)=>{s(!0);try{let r=await fetch("".concat(h,"/user-login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})}),o=await r.json();if(!r.ok||!o)return n.default.error(String((null==o?void 0:o.message)||"Login failed")),!1;let l=(null==o?void 0:o.token)||(null==o?void 0:o.access)||(null==o?void 0:o.access_token)||null,i=(null==o?void 0:o.user)||(null==o?void 0:o.data)||{id:o.id||"1",email:e,name:o.name||"User",role:"user"};if(!l)return!1;return p(l,i),n.default.success("Logged in successfully"),!0}catch(e){return n.default.error("Login error"),!1}finally{s(!1)}},g=async(e,t,r,o)=>{s(!0);try{let l=await fetch("".concat(h,"/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:t,password:r,...o?{contact:o}:{}})}),i=await l.json();if(!l.ok||void 0!==i.status&&!i.status)return n.default.error(String((null==i?void 0:i.message)||"Signup failed")),!1;let a=await y(t,r);return a&&n.default.success("Account created & logged in"),a}catch(e){return n.default.error("Signup error"),!1}finally{s(!1)}},m=async e=>{try{return await new Promise(e=>setTimeout(e,800)),!0}catch(e){return!1}},A=async()=>{if(d)try{let e=await fetch("".concat(h,"/api/user-profile"),{headers:{Authorization:"Bearer ".concat(d)}}),t=await e.json(),r={id:String(t.id),email:t.email,name:t.name,role:String(t.role||"user").toLowerCase()};i(r)}catch(e){}};return(0,o.jsx)(v.Provider,{value:{user:r,isLoading:u,login:y,logout:()=>{p(null,null),n.default.success("Logged out"),f.push("/")},signup:g,resetPassword:m,token:d,refreshMe:A},children:t})}},5884:function(e,t,r){r.r(t),r.d(t,{WishListProvider:function(){return s},useWishlist:function(){return d}});var o=r(7437),l=r(2265),n=r(8207),i=r(2502),a=r(5925);let u=(0,l.createContext)({favorites:[],loading:!1,error:null,refreshFavorites:async()=>{},addFavorite:async e=>{}}),s=e=>{let{children:t}=e,[r,s]=(0,l.useState)([]),[d,c]=(0,l.useState)(!1),[v,f]=(0,l.useState)(null),h=null;try{h=i.useAuth&&(0,i.useAuth)()}catch(e){h=null}let p=h&&(h.token||h.accessToken||h.authToken)||localStorage.getItem("token")||null,y=p?{Authorization:"Bearer ".concat(p)}:{},g=(0,l.useCallback)(async()=>{c(!0),f(null);try{var e,t,r;let o=await fetch("".concat(n.I,"/admin/users/list-favorite"),{method:"GET",headers:{...y}});if(!o.ok){let e=await o.text();throw Error("Failed to load favorites: ".concat(o.status," ").concat(e))}let l=await o.json(),i=[];if(Array.isArray(l))i=l;else{let t=null!==(e=null==l?void 0:l.data)&&void 0!==e?e:null;if(Array.isArray(t))i=t;else if(t&&Array.isArray(t.data))i=t.data;else{let e=null!=t?t:l;i=Array.isArray(null==e?void 0:e.favorites)&&e.favorites||Array.isArray(null==e?void 0:e.favorite)&&e.favorite||Array.isArray(null==e?void 0:e.favourites)&&e.favourites||Array.isArray(null==e?void 0:e.favourite)&&e.favourite||Array.isArray(null==e?void 0:e.wishlist)&&e.wishlist||Array.isArray(null==e?void 0:e.wishlists)&&e.wishlists||Array.isArray(null==e?void 0:e.result)&&e.result||[]}}let a=i.map(e=>{var t,r,o,l,n,i,a,u,s,d,c,v,f,h,p,y,g,m,A;let S=null!==(t=null==e?void 0:e.product)&&void 0!==t?t:null,w=null!==(i=null!==(n=null!==(l=null!==(o=null!==(r=null==e?void 0:e.product_id)&&void 0!==r?r:null==e?void 0:e.productId)&&void 0!==o?o:null==e?void 0:e.id)&&void 0!==l?l:null==S?void 0:S.id)&&void 0!==n?n:null==S?void 0:S._id)&&void 0!==i?i:null,_=null!==(d=null!==(s=null!==(u=null!==(a=null==e?void 0:e.name)&&void 0!==a?a:null==S?void 0:S.name)&&void 0!==u?u:null==e?void 0:e.product_name)&&void 0!==s?s:null==e?void 0:e.title)&&void 0!==d?d:null,k=null!==(h=null!==(f=null!==(v=null!==(c=null==e?void 0:e.price)&&void 0!==c?c:null==S?void 0:S.price)&&void 0!==v?v:null==e?void 0:e.product_price)&&void 0!==f?f:null==e?void 0:e.offerPrice)&&void 0!==h?h:null,P=null!==(m=null!==(g=null!==(y=null!==(p=null==S?void 0:S.image_url)&&void 0!==p?p:null==S?void 0:S.image_url)&&void 0!==y?y:null==e?void 0:e.image_url)&&void 0!==g?g:null==e?void 0:e.image_url)&&void 0!==m?m:null;return{...e,product:null!==(A=null!=S?S:null==e?void 0:e.product)&&void 0!==A?A:null,product_id:null!=w?String(w):null,product_name:_,product_price:k,product_image:P}}),u=new Set,d=[];for(let e of a){let o=String(null!==(r=null!==(t=null==e?void 0:e.product_id)&&void 0!==t?t:null==e?void 0:e.id)&&void 0!==r?r:"");o&&(u.has(o)||(u.add(o),d.push(e)))}s(d)}catch(e){f(e),s([])}finally{c(!1)}},[n.I,p]);(0,l.useEffect)(()=>{p?g():s([])},[p,g]);let m=(0,l.useCallback)(async e=>{if(!p){let e=Error("Not authenticated");throw f(e),a.default.error("Please log in first!"),e}f(null);let t=Array.isArray(r)?[...r]:[],o={id:e,product_id:e,pending:!0};s(t=>{var r;let l=Array.isArray(t)?t:[];return l.some(t=>String(null!==(r=null==t?void 0:t.product_id)&&void 0!==r?r:null==t?void 0:t.id)===String(e))?l:[...l,o]});try{let t=new FormData;t.append("product_id",String(e));let r=await fetch("".concat(n.I,"/admin/users/add-favorite"),{method:"POST",headers:{...y},body:t});if(!r.ok){let e=await r.text();throw Error("Add favorite failed: ".concat(r.status," ").concat(e))}let o=await r.json();return(null==o?void 0:o.status)&&a.default.success(o.message||"Added to favorites",{style:{background:"#fef2f2",color:"green",fontWeight:"600"},iconTheme:{primary:"green",secondary:"#fff"}}),await g(),o}catch(e){throw s(t),f(e),a.default.error("Failed to add favorite",{style:{background:"#fee2e2",color:"#7f1d1d",fontWeight:"600"}}),e}},[p,r,g]);return(0,o.jsx)(u.Provider,{value:{favorites:r,loading:d,error:v,refreshFavorites:g,addFavorite:m},children:t})},d=()=>{let e=(0,l.useContext)(u);if(!e)throw Error("useWishlist must be used within a WishListProvider");return e};t.default=u},8207:function(e,t,r){r.d(t,{DI:function(){return d},I:function(){return a},Sg:function(){return n},_g:function(){return u},bA:function(){return c},kE:function(){return i},nm:function(){return v}});var o=r(4829),l=r(2601);let n=(l.env.NEXT_PUBLIC_API_BASE||"https://ecom.nearbydoctors.in").replace(/\/+$/,""),i=(l.env.NEXT_PUBLIC_API_BASE_URL||"https://api.9nutz.com/api").replace(/\/+$/,""),a="https://9nutsapi.nearbydoctors.in/public/api".replace(/\/+$/,""),u="https://checkout.razorpay.com/v1/checkout.js";async function s(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=function(e){if(!e)return n;if(/^https?:\/\//i.test(e))return e;let t=String(e).replace(/^\/+/,"");return"".concat(n,"/").concat(t)}(e),l={method:r.method||"GET",headers:{...r.headers||{}},credentials:null!==(t=r.credentials)&&void 0!==t?t:"same-origin"};void 0!==r.body&&(l.headers={...l.headers||{},"Content-Type":"application/json"},l.body=JSON.stringify(r.body)),r.token&&(l.headers={...l.headers||{},Authorization:"Bearer ".concat(r.token)});let i=await fetch(o,l),a=await i.text(),u=null;try{u=a?JSON.parse(a):null}catch(e){u=a}if(!i.ok){let e=(null==u?void 0:u.message)||u||i.statusText,t=Error(String(e));throw t.status=i.status,t.body=u,t}return u}let d=(e,t)=>s("/api/admin/categories",{method:"POST",body:e,token:t}),c=(e,t,r)=>s("/api/admin/categories/".concat(e),{method:"PUT",body:t,token:r}),v=(e,t)=>s("/api/admin/categories/".concat(e),{method:"DELETE",token:t}),f=o.Z.create({baseURL:i,headers:{"Content-Type":"application/json"}});f.interceptors.request.use(e=>{{let t=window.localStorage.getItem("token");t&&(e.headers.Authorization="Bearer ".concat(t))}return e},e=>Promise.reject(e)),f.interceptors.response.use(e=>e,e=>Promise.reject(e)),t.ZP=f}}]);